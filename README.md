\# 💳 WHMCS Zarinpal Payment Gateway

ماژول درگاه پرداخت **زرین‌پال (Zarinpal)** برای **WHMCS**  

این ماژول امکان پرداخت امن و سریع از طریق درگاه زرین‌پال را برای کاربران فراهم می‌کند.

\## 🚀 ویژگی‌ها

\- پشتیبانی کامل از نسخه‌های جدید WHMCS  

\- رمزگذاری امن اطلاعات فاکتور (Base64 + Replace Encode)  

\- تأیید تراکنش‌ها از طریق API رسمی زرین‌پال (نسخه v4)  

\- ثبت تراکنش‌ها در لاگ WHMCS  

\- بازگشت خودکار به صفحه فاکتور پس از پرداخت  

\- مدیریت آسان و نصب سریع

\## 🧩 پیش‌نیازها

\- نسخه whmcs **7.10 یا بالاتر**  

\- فعال بودن افزونه `cURL` در PHP  

\- حساب کاربری فعال در \[[Zarinpal.com](http://Zarinpal.com)\](<https://zarinpal.com>)

\## ⚙️ نصب و راه‌اندازی

1\. فایل ماژول را در مسیر زیر آپلود کنید:

2\. وارد پنل مدیریت WHMCS شوید:

3\. از بخش **All Payment Gateways** گزینه **vozp** را انتخاب کنید.

4\. اطلاعات زیر را وارد نمایید:

| مرچند کد | شناسه مرچنت زرین‌پال شما |

| واحد پول| واحد پول (تومان یا ریال) |

| دپارتمان گزارش ارسال خطا | در صورتی که کاربر خطایی در پرداخت داشته باشد با زدن کلید گزارش خطا به این دپارتمان پشتیبانی تیکت ارسال میشود |

5\. تغییرات را ذخیره کنید ✅

\---

\## 🔑 ساخت لینک رمزگذاری‌شده فاکتور

در این ماژول، اطلاعات فاکتور (شماره، مبلغ و کاربر) با تابع `decodeHash()` رمزگشایی می‌شوند.

نمونه رمزگذاری داده‌ها:

```php
$replace = array(
 '1' => 'Q', '2' => 'W', '3' => 'E', '4' => 'Z',
 '5' => 'N', '6' => 'M', '7' => 'L', '8' => 'Y',
 '9' => 'U', '0' => 'D', ';' => 'V',
);
```

در هنگام بازگشت از زرین‌پال، اطلاعات رمزگشایی شده و بررسی می‌شود.

🔁 فرآیند پرداخت

کاربر فاکتور را در WHMCS مشاهده می‌کند.

روی گزینه پرداخت با زرین‌پال کلیک می‌کند.

اطلاعات فاکتور به صورت رمزگذاری‌شده به درگاه ارسال می‌شود.

پس از پرداخت، زرین‌پال نتیجه تراکنش را به اسکریپت callback بازمی‌گرداند.

سیستم پرداخت را تأیید کرده و فاکتور را به‌صورت خودکار پرداخت‌شده ثبت می‌کند.

📄 فایل‌های اصلی

فایل	توضیح

modules/gateways/vozp.php	فایل اصلی ماژول درگاه پرداخت

modules/gateways/callback/vozp.php	بررسی وضعیت تراکنش و ثبت پرداخت

**مستندات ماژول**

🧠 توضیح تابع رمزگشایی

```php
$replace = array(
 '1' => 'Q', '2' => 'W', '3' => 'E', '4' => 'Z',
 '5' => 'N', '6' => 'M', '7' => 'L', '8' => 'Y',
 '9' => 'U', '0' => 'D', ';' => 'V',
);
```

📦 پاسخ سرور زرین‌پال

در فایل callback، تأیید تراکنش از طریق API زیر انجام می‌شود:

POST <https://api.zarinpal.com/pg/v4/payment/verify.json>

پارامترهای ارسال‌شده:

```{
  "merchant_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "authority": "A00000000000000000000000000123456789",
  "amount": 10000
}```

در صورت موفقیت:

```{
  "data": {
    "code": 100,
    "ref_id": "1234567890"
  }
}```

🛡️ نکات امنیتی

اطمینان حاصل کنید که URL بازگشت (callback) فقط از طریق HTTPS در دسترس باشد.

هیچ داده‌ای را بدون رمزگذاری ارسال نکنید.

از توکن معتبر زرین‌پال استفاده کنید.

👨‍💻 توسعه‌دهنده

توسعه‌دهنده: Vahab Seyed Chorteh

وبسایت: [vahabonline.ir](http://vahabonline.ir)

📜 مجوز (License)

کد منبع تحت مجوز MIT License منتشر شده است.

شما می‌توانید آزادانه آن را ویرایش، توسعه و استفاده نمایید.

⭐ حمایت کنید

اگر این ماژول برای شما مفید بود، با دادن ⭐ در GitHub از توسعه ادامه‌اش حمایت کنید 💙
